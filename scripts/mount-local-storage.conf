# mountall - Mount filesystems on boot
#
# This helper mounts filesystems in the correct order as the devices
# and mountpoints become available.

description	"Mount instance storage on boot"

start on startup

task

script
	if ! blkid | grep -qF /dev/xvdb; then
		mkfs.ext4 /dev/xvdb -L "instance_storage"
	fi
	if ! mount | grep -qF /dev/xvdb; then
		mkdir -p /mnt
		mount /dev/xvdb /mnt
	fi

	# Mongo specific
	mkdir -p /log
	mkdir -p /mnt/data
	chown -R mongodb:mongodb /mnt/data /log
	ln -s /mnt/data /data
end script

